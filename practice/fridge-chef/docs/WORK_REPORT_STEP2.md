# Fridge Chef Step 2 êµ¬í˜„ ì‘ì—… ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-12-26
**ì‘ì—…ì**: Claude Code (Opus 4.5)

---

## 1. ì‘ì—… ê°œìš”

### 1.1 ì‘ì—… ëª©í‘œ
Fridge Chef í”„ë¡œì íŠ¸ì˜ Step 2 "AI ë ˆì‹œí”¼ ìƒì„±" ê¸°ëŠ¥ êµ¬í˜„

### 1.2 ì‘ì—… ë²”ìœ„
- ì¬ë£Œ ê¸°ë°˜ ë ˆì‹œí”¼ ìƒì„± AI ì—°ë™
- ìš”ë¦¬ ì„¤ì • ì˜µì…˜ (ë‚œì´ë„, ì‹œê°„, ì‹ì´ì œí•œ)
- ë ˆì‹œí”¼ ì¹´ë“œ UI ì»´í¬ë„ŒíŠ¸
- Step 1ê³¼ì˜ ì„¸ì…˜ ìƒíƒœ ì—°ë™

---

## 2. ì‚¬ìš©ëœ ë„êµ¬ (Tools)

### 2.1 íŒŒì¼ ì‘ì—… ë„êµ¬

| Tool | ìš©ë„ | ì‚¬ìš© íšŸìˆ˜ |
|------|------|-----------|
| **Read** | PRD ë° ê¸°ì¡´ ì½”ë“œ ë¶„ì„ | ë‹¤ìˆ˜ |
| **Write** | ìƒˆ íŒŒì¼ ìƒì„± | 4+ |
| **Edit** | ê¸°ì¡´ íŒŒì¼ ìˆ˜ì • | 5+ |
| **Glob** | íŒŒì¼ íŒ¨í„´ ê²€ìƒ‰ | ì¼ë¶€ |

### 2.2 ì‹¤í–‰ ë„êµ¬

| Tool | ìš©ë„ | ì£¼ìš” ëª…ë ¹ì–´ |
|------|------|-------------|
| **Bash** | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | `uv run pytest tests/ -v` |

---

## 3. ì‘ì—… ê³¼ì •

### Phase 1: ìš”êµ¬ì‚¬í•­ ë¶„ì„
1. `PRD_step2.md` íŒŒì¼ ì½ê¸°
2. Step 1ì—ì„œ ì „ë‹¬ë˜ëŠ” ì¬ë£Œ ë°ì´í„° êµ¬ì¡° í™•ì¸
3. ë ˆì‹œí”¼ ì¶œë ¥ JSON ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### Phase 2: Recipe ì„œë¹„ìŠ¤ êµ¬í˜„

**services/recipe.py ì£¼ìš” êµ¬ì„±ìš”ì†Œ**:

```python
class RecipeService:
    """OpenRouter APIë¥¼ í†µí•œ ë ˆì‹œí”¼ ìƒì„± ì„œë¹„ìŠ¤"""

    MODEL = "nex-agi/deepseek-v3.1-nex-n1:free"
    API_URL = "https://openrouter.ai/api/v1/chat/completions"

    def generate_recipes(
        self,
        ingredients: list[str],
        settings: dict | None = None,
    ) -> list[dict]:
        """ì¬ë£Œ ëª©ë¡ìœ¼ë¡œ ë ˆì‹œí”¼ ìƒì„±"""
```

**ë ˆì‹œí”¼ ìƒì„± ì„¤ì • ì˜µì…˜**:
```python
settings = {
    "difficulty": "ì‰¬ì›€" | "ë³´í†µ" | "ì–´ë ¤ì›€",
    "max_cooking_time": 30,  # ë¶„ ë‹¨ìœ„
    "dietary_restrictions": ["ì±„ì‹", "ì €ì—¼ì‹", ...],
    "recipe_count": 3,  # ìƒì„±í•  ë ˆì‹œí”¼ ìˆ˜
}
```

### Phase 3: í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§

**ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸**:
```
ë‹¹ì‹ ì€ ì „ë¬¸ ìš”ë¦¬ì‚¬ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ì¬ë£Œë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë§›ìˆëŠ” ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.
ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”.
```

**JSON ì¶œë ¥ ìŠ¤í‚¤ë§ˆ**:
```json
{
  "recipes": [
    {
      "name": "ë ˆì‹œí”¼ ì´ë¦„",
      "difficulty": "ì‰¬ì›€|ë³´í†µ|ì–´ë ¤ì›€",
      "cooking_time": 30,
      "servings": 2,
      "ingredients": {
        "available": ["ì¬ë£Œ1", "ì¬ë£Œ2"],
        "additional_needed": ["ì¶”ê°€ ì¬ë£Œ1"]
      },
      "instructions": [
        "1. ì²« ë²ˆì§¸ ë‹¨ê³„",
        "2. ë‘ ë²ˆì§¸ ë‹¨ê³„"
      ],
      "tips": ["ìš”ë¦¬ íŒ1", "ìš”ë¦¬ íŒ2"]
    }
  ]
}
```

### Phase 4: UI í˜ì´ì§€ êµ¬í˜„

**pages/2_ğŸ“–_ë ˆì‹œí”¼_ìƒì„±.py ì£¼ìš” ê¸°ëŠ¥**:

1. **ìš”ë¦¬ ì„¤ì • ì‚¬ì´ë“œë°”**:
   ```python
   with st.sidebar:
       difficulty = st.select_slider("ë‚œì´ë„", ["ì‰¬ì›€", "ë³´í†µ", "ì–´ë ¤ì›€"])
       max_time = st.slider("ìµœëŒ€ ì¡°ë¦¬ ì‹œê°„", 10, 120, 30)
       dietary = st.multiselect("ì‹ì´ ì œí•œ", ["ì±„ì‹", "ë¹„ê±´", "ì €ì—¼ì‹", ...])
   ```

2. **ë ˆì‹œí”¼ ìƒì„± íë¦„**:
   ```python
   if st.button("ğŸ³ ë ˆì‹œí”¼ ìƒì„±"):
       ingredients = st.session_state.recognized_ingredients
       settings = {"difficulty": difficulty, "max_cooking_time": max_time, ...}
       recipes = recipe_service.generate_recipes(ingredients, settings)
       st.session_state.generated_recipes = recipes
   ```

3. **ë ˆì‹œí”¼ ì¹´ë“œ í‘œì‹œ**:
   - ë ˆì‹œí”¼ ì´ë¦„ ë° ê¸°ë³¸ ì •ë³´
   - í•„ìš” ì¬ë£Œ (ë³´ìœ /ì¶”ê°€ êµ¬ë§¤ êµ¬ë¶„)
   - ì¡°ë¦¬ ë‹¨ê³„ (ìˆœì„œëŒ€ë¡œ í‘œì‹œ)
   - ìš”ë¦¬ íŒ

### Phase 5: ë ˆì‹œí”¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

**components/recipe_card.py**:
```python
def render_recipe_card(recipe: dict, key_prefix: str = "") -> None:
    """ë ˆì‹œí”¼ ì¹´ë“œ UI ë Œë”ë§"""
    with st.container():
        st.subheader(f"ğŸ½ï¸ {recipe['name']}")

        # ë©”íƒ€ ì •ë³´
        cols = st.columns(3)
        cols[0].metric("ë‚œì´ë„", recipe["difficulty"])
        cols[1].metric("ì¡°ë¦¬ ì‹œê°„", f"{recipe['cooking_time']}ë¶„")
        cols[2].metric("ì¸ë¶„", f"{recipe['servings']}ì¸ë¶„")

        # ì¬ë£Œ í‘œì‹œ
        st.markdown("**ğŸ“¦ í•„ìš” ì¬ë£Œ**")
        # ... ë³´ìœ  ì¬ë£Œ / ì¶”ê°€ ì¬ë£Œ êµ¬ë¶„ í‘œì‹œ

        # ì¡°ë¦¬ ë‹¨ê³„
        st.markdown("**ğŸ‘¨â€ğŸ³ ì¡°ë¦¬ ìˆœì„œ**")
        for i, step in enumerate(recipe["instructions"], 1):
            st.markdown(f"{i}. {step}")
```

---

## 4. ê¸°ìˆ ì  ê²°ì • ì‚¬í•­

### 4.1 Text ëª¨ë¸ ì„ íƒ
- **ì„ íƒ**: `nex-agi/deepseek-v3.1-nex-n1:free`
- **ì´ìœ **: ë¬´ë£Œ API, í•œêµ­ì–´ ë ˆì‹œí”¼ ìƒì„± í’ˆì§ˆ ìš°ìˆ˜, JSON ì¶œë ¥ ì•ˆì •ì 

### 4.2 JSON ì¶œë ¥ ë³´ì¥
- **Few-shot ì˜ˆì œ**: í”„ë¡¬í”„íŠ¸ì— ì˜ˆì‹œ JSON í¬í•¨
- **JSON íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬**: ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì œê±° í›„ íŒŒì‹±
- **Fallback**: íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¹ˆ ë ˆì‹œí”¼ ëª©ë¡ ë°˜í™˜

### 4.3 ì¬ë£Œ ë§¤ì¹­ ë¡œì§
```python
def categorize_ingredients(recipe_ingredients: list, available: list) -> dict:
    """ë³´ìœ  ì¬ë£Œì™€ ì¶”ê°€ í•„ìš” ì¬ë£Œ ë¶„ë¥˜"""
    available_set = set(i.lower() for i in available)
    return {
        "available": [i for i in recipe_ingredients if i.lower() in available_set],
        "additional_needed": [i for i in recipe_ingredients if i.lower() not in available_set]
    }
```

---

## 5. ìƒì„±ëœ íŒŒì¼ ëª©ë¡

| ë””ë ‰í† ë¦¬ | íŒŒì¼ | ì„¤ëª… |
|----------|------|------|
| `pages/` | `2_ğŸ“–_ë ˆì‹œí”¼_ìƒì„±.py` | ë ˆì‹œí”¼ ìƒì„± í˜ì´ì§€ |
| `services/` | `recipe.py` | Recipe ìƒì„± ì„œë¹„ìŠ¤ |
| `components/` | `recipe_card.py` | ë ˆì‹œí”¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ |

---

## 6. ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© |
|------|-----------|
| `pyproject.toml` | ì¶”ê°€ ì˜ì¡´ì„± í™•ì¸ |
| `app.py` | ë©”ì¸ í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ |

---

## 7. API ì—°ë™ ìƒì„¸

### 7.1 OpenRouter API êµ¬ì¡°

**Request**:
```json
{
  "model": "nex-agi/deepseek-v3.1-nex-n1:free",
  "messages": [
    {"role": "system", "content": "ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸"},
    {"role": "user", "content": "ì¬ë£Œ: ë‹¹ê·¼, ì–‘íŒŒ, ëŒ€íŒŒ\nì„¤ì •: ë‚œì´ë„ ì‰¬ì›€, 30ë¶„ ì´ë‚´"}
  ],
  "response_format": {"type": "json_object"}
}
```

**Response ì²˜ë¦¬**:
```python
response_text = response["choices"][0]["message"]["content"]
# ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ ì œê±°
if "```json" in response_text:
    response_text = response_text.split("```json")[1].split("```")[0]
recipes = json.loads(response_text)["recipes"]
```

### 7.2 ì—ëŸ¬ ì²˜ë¦¬
- JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¡œê·¸ ê¸°ë¡ ë° ë¹ˆ ê²°ê³¼ ë°˜í™˜
- API íƒ€ì„ì•„ì›ƒ ì‹œ ì¬ì‹œë„ ì•ˆë‚´
- ì¬ë£Œ ë¶€ì¡± ì‹œ ì¶”ê°€ ì¬ë£Œ êµ¬ë§¤ ì•ˆë‚´

---

## 8. UI/UX ì„¤ê³„

### 8.1 í˜ì´ì§€ ë ˆì´ì•„ì›ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“– ë ˆì‹œí”¼ ìƒì„±                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì‚¬ì´ë“œë°”]    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚               â”‚  â”‚ ğŸ“¦ ì„ íƒëœ ì¬ë£Œ: ë‹¹ê·¼, ì–‘íŒŒ, ëŒ€íŒŒ     â”‚ â”‚
â”‚  ë‚œì´ë„:      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  [ì‰¬ì›€]       â”‚  â”‚        [ğŸ³ ë ˆì‹œí”¼ ìƒì„±]              â”‚ â”‚
â”‚               â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  ì¡°ë¦¬ì‹œê°„:    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  [30ë¶„]       â”‚  â”‚ â”‚ ğŸ½ï¸ ë‹¹ê·¼ ë³¶ìŒ                    â”‚ â”‚ â”‚
â”‚               â”‚  â”‚ â”‚ ë‚œì´ë„: ì‰¬ì›€ | ì‹œê°„: 15ë¶„        â”‚ â”‚ â”‚
â”‚  ì‹ì´ ì œí•œ:   â”‚  â”‚ â”‚ ì¬ë£Œ: ë‹¹ê·¼, ì–‘íŒŒ...              â”‚ â”‚ â”‚
â”‚  [ ] ì±„ì‹     â”‚  â”‚ â”‚ 1. ë‹¹ê·¼ì„ ì±„ ì¬ë‹¤               â”‚ â”‚ â”‚
â”‚  [ ] ì €ì—¼     â”‚  â”‚ â”‚ 2. íŒ¬ì— ê¸°ë¦„ì„ ë‘ë¥¸ë‹¤           â”‚ â”‚ â”‚
â”‚               â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ì‚¬ìš©ì íë¦„
1. Step 1ì—ì„œ ì¬ë£Œ ëª©ë¡ í™•ì¸
2. ì‚¬ì´ë“œë°”ì—ì„œ ìš”ë¦¬ ì„¤ì • ì¡°ì •
3. "ë ˆì‹œí”¼ ìƒì„±" ë²„íŠ¼ í´ë¦­
4. AIê°€ ìƒì„±í•œ ë ˆì‹œí”¼ ì¹´ë“œ í™•ì¸
5. ì›í•˜ëŠ” ë ˆì‹œí”¼ ì„ íƒ ë° ì €ì¥ (Step 3)

---

## 9. ì„¸ì…˜ ìƒíƒœ ì—°ë™

### 9.1 Step 1 â†’ Step 2 ë°ì´í„° íë¦„
```python
# Step 1ì—ì„œ ì„¤ì •
st.session_state.recognized_ingredients = ["ë‹¹ê·¼", "ì–‘íŒŒ", "ëŒ€íŒŒ"]

# Step 2ì—ì„œ ì‚¬ìš©
ingredients = st.session_state.get("recognized_ingredients", [])
if not ingredients:
    st.warning("ë¨¼ì € ì¬ë£Œ ì¸ì‹ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.")
    st.page_link("pages/1_ğŸ³_ì¬ë£Œ_ì¸ì‹.py", label="ì¬ë£Œ ì¸ì‹ìœ¼ë¡œ ì´ë™")
```

### 9.2 Step 2 â†’ Step 3 ë°ì´í„° íë¦„
```python
# Step 2ì—ì„œ ì„¤ì •
st.session_state.generated_recipes = recipes

# Step 3ì—ì„œ ì €ì¥ ì‹œ ì‚¬ìš©
recipe_to_save = st.session_state.generated_recipes[selected_index]
```

---

## 10. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

```python
# tests/test_recipe.py
class TestRecipeService:
    def test_generate_recipes_basic(self):
        """ê¸°ë³¸ ë ˆì‹œí”¼ ìƒì„± í…ŒìŠ¤íŠ¸"""

    def test_generate_recipes_with_settings(self):
        """ì„¤ì • ì˜µì…˜ ì ìš© í…ŒìŠ¤íŠ¸"""

    def test_json_parsing_robustness(self):
        """JSON íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸"""

    def test_empty_ingredients(self):
        """ë¹ˆ ì¬ë£Œ ëª©ë¡ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸"""
```

---

## 11. í–¥í›„ ê°œì„  ì‚¬í•­

1. **ë ˆì‹œí”¼ í’ˆì§ˆ í–¥ìƒ**: ë” ìƒì„¸í•œ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
2. **ì˜ì–‘ ì •ë³´ ì¶”ê°€**: ì¹¼ë¡œë¦¬, ì˜ì–‘ì†Œ ê³„ì‚° ê¸°ëŠ¥
3. **ë ˆì‹œí”¼ í•„í„°ë§**: ì•Œë ˆë¥´ê¸°, ì„ í˜¸ë„ ê¸°ë°˜ í•„í„°
4. **ìš”ë¦¬ íƒ€ì´ë¨¸**: ê° ë‹¨ê³„ë³„ íƒ€ì´ë¨¸ ê¸°ëŠ¥
5. **ì¬ë£Œ ëŒ€ì²´ ì¶”ì²œ**: ì—†ëŠ” ì¬ë£Œì˜ ëŒ€ì²´í’ˆ ì¶”ì²œ
6. **ë ˆì‹œí”¼ í‰ì **: ì‚¬ìš©ì í‰ê°€ ê¸°ë°˜ í’ˆì§ˆ ê°œì„ 

---

*ë³¸ ë³´ê³ ì„œëŠ” Claude Code (Opus 4.5)ì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
